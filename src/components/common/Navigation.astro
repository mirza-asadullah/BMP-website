---
import LanguageSwitcher from "./LanguageSwitcher.astro";

interface Props {
  currentPath?: string;
}

const { currentPath = "/" } = Astro.props;

const mainNavItems = [
  { key: 'nav.home', label: "Inicio", href: "/" },
];

const aboutItem = { key: 'nav.about', label: "Sobre nosotros", href: "/Aboutus" };

const featureItems = [
  { key: 'nav.chat', label: "Chat", href: "/chat" },
  { key: 'nav.wallet', label: "Wallet", href: "/wallet" },
  { key: 'nav.marketplace', label: "Marketplace", href: "/marketplace" },
  { key: 'nav.apps', label: "Apps", href: "/apps" },
  { key: 'nav.nutrition', label: "Nutrición", href: "/nutrition" },
  { key: 'nav.communities', label: "Comunidad", href: "/communities" },
  { key: 'nav.musica', label: "Música", href: "/musica" },
  { key: 'nav.salud-mental', label: "Salud Mental", href: "/salud-mental" },
  { key: 'nav.finance', label: "Finanzas", href: "/finance" },
];

const contactItem = { key: 'nav.contact', label: "Contacto", href: "/Contactus" };

const footerNavItems = [
  aboutItem,
  contactItem,
];
---

<nav class="relative flex items-center gap-8">
  <!-- Main Navigation (Desktop) -->
  <ul class="hidden min-[900px]:flex items-center gap-1">
    {
      mainNavItems.map((item, index) => (
        <li>
          <a
            href={item.href}
            class:list={[
              "px-2 py-2 text-xs font-normal transition-colors duration-300 whitespace-nowrap",
              currentPath === item.href ? "text-white border-b-2 border-white" : "text-white/70 hover:text-white",
              `stagger-${index + 1}`,
            ]}
          >
            {item.key ? <span data-i18n={item.key}>{item.label}</span> : item.label}
          </a>
        </li>
      ))
    }

    <!-- Features Dropdown -->
    <li class="relative group">
      <button
        class="px-2 py-2 text-xs font-normal text-white/70 hover:text-white transition-colors duration-300 whitespace-nowrap flex items-center gap-1 cursor-default"
      >
        <span data-i18n="nav.features">Features</span>
        <svg class="w-3 h-3 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </button>

      <div class="absolute top-full left-1/2 -translate-x-1/2 pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 z-50">
        <div class="bg-[#120068]/95 backdrop-blur-xl rounded-2xl border border-white/10 p-2 shadow-2xl min-w-[160px]">
          <ul class="flex flex-col gap-1">
            {
              featureItems.map((item) => (
                <li>
                  <a
                    href={item.href}
                    class:list={[
                      "block px-4 py-2 text-xs font-normal rounded-xl transition-colors whitespace-nowrap",
                      currentPath === item.href ? "bg-white/10 text-white" : "text-white/70 hover:bg-white/5 hover:text-white",
                    ]}
                  >
                    {item.key ? <span data-i18n={item.key}>{item.label}</span> : item.label}
                  </a>
                </li>
              ))
            }
          </ul>
        </div>
      </div>
    </li>

    {
      footerNavItems.map((item, index) => (
        <li>
          <a
            href={item.href}
            class:list={[
              "px-2 py-2 text-xs font-normal transition-colors duration-300 whitespace-nowrap",
              currentPath === item.href ? "text-white border-b-2 border-white" : "text-white/70 hover:text-white",
              `stagger-${mainNavItems.length + 1 + index}`,
            ]}
          >
            {item.key ? <span data-i18n={item.key}>{item.label}</span> : item.label}
          </a>
        </li>
      ))
    }
  </ul>

  <!-- Mobile Menu Button -->
  <button
    id="mobile-menu-btn"
    class="min-[900px]:hidden p-2 rounded-lg text-white hover:bg-white/10 transition-colors"
    aria-label="Abrir menú"
  >
    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M4 6h16M4 12h16M4 18h16"></path>
    </svg>
  </button>

  <!-- Mobile Menu Dropdown -->
  <div
    id="mobile-menu"
    class="absolute top-full right-[-60px] mt-2 w-64 hidden origin-top-right z-50"
  >
    <div class="bg-[#13045D]/100 rounded-2xl w-full p-2 animate-menu-pop shadow-2xl overflow-y-auto max-h-[80vh]">
      <ul class="flex flex-col w-full gap-1">
        <!-- Home -->
        <li>
          <a
            href="/"
            class:list={[
              "flex items-center w-full px-4 py-2 text-sm font-medium rounded-xl transition-colors",
              currentPath === "/" ? "bg-white/10 text-white" : "text-white/70 hover:bg-white/10 hover:text-white"
            ]}
          >
            <span data-i18n="nav.home">Home</span>
          </a>
        </li>

        <!-- Features (Collapsible) -->
        <li>
          <button
            id="mobile-features-trigger"
            class="flex items-center justify-start gap-2 w-full px-4 py-2 text-sm font-medium rounded-xl text-white/70 hover:bg-white/10 hover:text-white transition-colors group"
          >
            <span data-i18n="nav.features">Features</span>
            <svg id="mobile-features-arrow" class="w-4 h-4 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          
          <div id="mobile-features-content" class="hidden overflow-hidden transition-all duration-300 pl-4">
            <ul class="flex flex-col gap-1 py-1">
              {
                featureItems.map((item) => (
                  <li>
                    <a
                      href={item.href}
                      class:list={[
                        "flex items-center w-full px-4 py-2 text-[13px] font-normal rounded-xl transition-colors",
                        currentPath === item.href ? "text-white font-medium shadow-[0_0_15px_rgba(255,255,255,0.1)]" : "text-white/60 hover:bg-white/5 hover:text-white"
                      ]}
                    >
                      {item.key ? <span data-i18n={item.key}>{item.label}</span> : item.label}
                    </a>
                  </li>
                ))
              }
            </ul>
          </div>
        </li>

        <!-- About Us -->
        <li>
          <a
            href={aboutItem.href}
            class:list={[
              "flex items-center w-full px-4 py-2 text-sm font-medium rounded-xl transition-colors",
              currentPath === aboutItem.href ? "bg-white/10 text-white" : "text-white/70 hover:bg-white/10 hover:text-white"
            ]}
          >
            <span data-i18n={aboutItem.key}>{aboutItem.label}</span>
          </a>
        </li>

        <!-- Contact -->
        <li>
          <a
            href={contactItem.href}
            class:list={[
              "flex items-center w-full px-4 py-2 text-sm font-medium rounded-xl transition-colors",
              currentPath === contactItem.href ? "bg-white/10 text-white" : "text-white/70 hover:bg-white/10 hover:text-white"
            ]}
          >
            <span data-i18n={contactItem.key}>{contactItem.label}</span>
          </a>
        </li>

        <li class="h-px bg-white/10 my-1 mx-2"></li>
   

        <!-- Language Switcher -->
        <li class="mt-2">
          <LanguageSwitcher size="sm" variant="inline" />
        </li>
      </ul>
    </div>
  </div>
</nav>

<script>
  const initNavigationMenu = () => {
    const mobileMenuBtn = document.getElementById("mobile-menu-btn");
    const mobileMenu = document.getElementById("mobile-menu");
    const featuresTrigger = document.getElementById("mobile-features-trigger");
    const featuresContent = document.getElementById("mobile-features-content");
    const featuresArrow = document.getElementById("mobile-features-arrow");

    if (!mobileMenuBtn || !mobileMenu) return;

    const toggleMenu = (e: Event) => {
      e.stopPropagation();
      mobileMenu.classList.toggle("hidden");
    };

    const closeMenu = () => {
      if (!mobileMenu.classList.contains("hidden")) {
        mobileMenu.classList.add("hidden");
        // Also resets features collapse when closing menu
        if (featuresContent) featuresContent.classList.add("hidden");
        if (featuresArrow) featuresArrow.style.transform = "";
      }
    };

    // Features collapsible logic
    if (featuresTrigger && featuresContent && featuresArrow) {
      featuresTrigger.addEventListener("click", (e) => {
        e.stopPropagation();
        const isHidden = featuresContent.classList.contains("hidden");
        if (isHidden) {
          featuresContent.classList.remove("hidden");
          featuresArrow.style.transform = "rotate(180deg)";
        } else {
          featuresContent.classList.add("hidden");
          featuresArrow.style.transform = "";
        }
      });
    }

    mobileMenuBtn.addEventListener("click", toggleMenu);

    // Close on link click (only for actual links, not the trigger button)
    mobileMenu.querySelectorAll("a").forEach((link) => {
      link.addEventListener("click", closeMenu);
    });

    // Close on click outside
    document.addEventListener("click", (event) => {
      if (
        !mobileMenu.contains(event.target as Node) &&
        !mobileMenuBtn.contains(event.target as Node)
      ) {
        closeMenu();
      }
    });
  };

  document.addEventListener('astro:page-load', initNavigationMenu);
</script>

<style>
  @keyframes menu-pop {
    0% {
      opacity: 0;
      transform: scale(0.95) translateX(20px);
    }
    100% {
      opacity: 1;
      transform: scale(1) translateX(0);
    }
  }

  .animate-menu-pop {
    animation: menu-pop 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }
</style>
